# Session 2025-11-23: Recursive.eco Feature Implementation

> Comprehensive implementation plan for Recursive Creator fixes + Recursive Landing enhancements + Local playlist import

# Recommendation: Start with Recursive-Landing

  Reasoning:
  - üéØ Thanksgiving deadline - landing features are what you need for family
  playlists
  - ‚úÖ Quick win first - CSV export (30-45 min) gives immediate value
  - üîÑ Then tackle harder ones - transparent layer & calendar while I have context       
  - ‚è∞ Creator fixes can wait - they're quality-of-life improvements, not launch
  blockers

  Proposed Flow:
  1. Phase 2.2 - CSV export (EASIEST, immediate win)
  2. Phase 2.1 - Transparent layer (safety feature)
  3. Phase 2.3 - Calendar .ics (family planning)
  4. Phase 3 - Local import (bonus UX)
  5. Phase 1 - Creator fixes (post-Thanksgiving)

**Date:** 2025-11-23
**Projects:** recursive-creator, recursive-landing
**Goal:** Launch-ready features for Thanksgiving family playlists

---

## Overview

Today we're implementing interconnected features across both projects:
1. **Recursive Creator** - Fix import append behavior + improve license wording
2. **Recursive Landing** - Child safety features + calendar export + email collection
3. **Local Playlist Import** - Anonymous YouTube playlist import with localStorage

---

## Project 1: Recursive Creator Fixes

### Task 1.1: Fix Import Append Behavior ‚è≥
**Priority:** HIGH
**Time Estimate:** 30-60 min
**File:** `recursive-creator/app/dashboard/sequences/new/page.tsx`

**Problem:** When importing YouTube playlist or Drive folder, it **replaces** existing links instead of **appending** to the end.

**Current Behavior:**
```javascript
// Likely something like:
setItems(newItems); // ‚ùå REPLACES all items
```

**Desired Behavior:**
```javascript
// Should append:
setItems([...items, ...newItems]); // ‚úÖ ADDS to existing items
```

**Implementation Steps:**
1. Find the import handlers:
   - `handleImportPlaylist` (YouTube playlist import)
   - `handleImportFolder` (Drive folder import)
2. Change from `setItems(newItems)` to `setItems([...items, ...newItems])`
3. Update position numbers for new items (continue from last position)
4. Test with existing sequence + import

**Success Criteria:**
- [ ] Import YouTube playlist with existing items ‚Üí new videos added to end
- [ ] Import Drive folder with existing items ‚Üí new images added to end
- [ ] Position numbers increment correctly
- [ ] No duplicate items

---

### Task 1.2: Improve License Note Wording ‚è≥
**Priority:** MEDIUM
**Time Estimate:** 10-15 min
**File:** `recursive-creator/app/dashboard/sequences/new/page.tsx`

**Current Wording:** (Need to check existing license checkbox)

**Proposed Wording:**
```tsx
<label className="flex items-start gap-3 cursor-pointer">
  <input
    type="checkbox"
    checked={licenseAgreed}
    onChange={(e) => setLicenseAgreed(e.target.checked)}
    className="mt-1 w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500"
  />
  <span className="text-sm text-gray-800">
    I confirm that all content <strong>not coming from YouTube</strong> or
    specifically attributed under a license in the image itself can be
    published under <a
      href="https://creativecommons.org/licenses/by-sa/4.0/"
      target="_blank"
      className="text-purple-600 underline"
    >CC BY-SA 4.0 license</a>.
    Without direct attribution to YouTube or other license, this content
    will be assumed to be published under Creative Commons.
  </span>
</label>
```

**Key Changes:**
- ‚úÖ Clarifies "content NOT from YouTube" is under CC BY-SA
- ‚úÖ Mentions "specifically attributed" content exceptions
- ‚úÖ States assumption: no attribution = CC BY-SA
- ‚úÖ More conversational tone

**Success Criteria:**
- [ ] Checkbox text updated
- [ ] Link to CC BY-SA 4.0 works
- [ ] Wording is clear and not intimidating

---

## Project 2: Recursive Landing Features

### Priority 1 (Must-have for Thanksgiving Launch)

#### Task 2.1: Add Transparent Layer (Prevent YouTube Clicks) ‚è≥
**Priority:** HIGH
**Time Estimate:** 1-2 hours
**File:** `recursive-landing/view.html`

**Problem:** Kids can click YouTube logo/title and navigate to unprotected YouTube.

**Solution:** Add transparent overlay that shows link but doesn't allow clicks.

**Implementation:**
```html
<!-- Add after YouTube player div -->
<div id="youtube-link-overlay" style="
  position: absolute;
  bottom: 60px;
  left: 0;
  right: 0;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 12px;
  text-align: center;
  font-size: 14px;
  backdrop-filter: blur(4px);
  display: none;
">
  <p style="margin: 0; color: #d1d5db;">
    Source: <span id="youtube-link-text" style="font-family: monospace; color: white;"></span>
  </p>
  <p style="margin: 4px 0 0 0; font-size: 12px; color: #9ca3af;">
    (Link visible for transparency, not clickable for safety)
  </p>
</div>
```

**Behavior:**
- Shows YouTube URL as plain text (no hyperlink)
- Appears on hover or after pause
- Cannot be clicked or copied easily
- Adds friction while maintaining transparency

**Success Criteria:**
- [ ] YouTube URL displayed as text (not link)
- [ ] Cannot click through to YouTube
- [ ] Still visible for attribution/transparency
- [ ] Works on mobile (touch)

---

#### Task 2.2: Add CSV Export Button ("See the Program") ‚è≥
**Priority:** HIGH
**Time Estimate:** 30-45 min
**File:** `recursive-landing/view.html`

**Feature:** Export complete list of titles and links as CSV file.

**UI Location:** Next to "Create Your Own" button

**Implementation:**
```html
<!-- Add button -->
<button id="export-csv-btn" class="inline-block px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold shadow-lg">
  üìã See the Program
</button>

<script>
document.getElementById('export-csv-btn').addEventListener('click', () => {
  if (!currentItems || currentItems.length === 0) {
    alert('No content loaded to export');
    return;
  }

  // Create CSV header
  let csv = 'Position,Title,Type,Link\n';

  // Add each item
  currentItems.forEach((item, index) => {
    const title = (item.title || `Item ${index + 1}`).replace(/"/g, '""'); // Escape quotes
    const type = item.type;
    let link = '';

    if (type === 'video') {
      if (item.url) {
        link = item.url;
      } else if (item.video_id) {
        // YouTube
        if (item.video_id.length === 11) {
          link = `https://youtube.com/watch?v=${item.video_id}`;
        } else {
          // Google Drive
          link = `https://drive.google.com/file/d/${item.video_id}/view`;
        }
      }
    } else if (type === 'image') {
      link = item.image_url || '';
    }

    csv += `${index + 1},"${title}",${type},"${link}"\n`;
  });

  // Create download
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `${currentContent.title || 'playlist'}-program.csv`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
});
</script>
```

**Success Criteria:**
- [ ] Button appears next to "Create Your Own"
- [ ] CSV downloads with all titles and links
- [ ] Format: Position, Title, Type, Link
- [ ] Filename includes playlist title

---

#### Task 2.3: Add Calendar .ics Generation ‚è≥
**Priority:** HIGH
**Time Estimate:** 1.5-2 hours
**File:** `recursive-landing/view.html`

**Feature:** "Put in your calendar" button to generate .ics file for ritual/playlist.

**UI Location:** Next to "Create Your Own" button

**Implementation:**

**Step 1: Create ICS Utility Function**
```javascript
function generateICS(title, description, startDate, durationMinutes, url) {
  const start = new Date(startDate);
  const end = new Date(start.getTime() + durationMinutes * 60000);

  // Format dates as YYYYMMDDTHHMMSSZ (UTC)
  const formatDate = (date) => {
    return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
  };

  const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Recursive.Eco//Family Art Ritual//EN
BEGIN:VEVENT
UID:${Date.now()}-${Math.random().toString(36)}@recursive.eco
DTSTAMP:${formatDate(new Date())}
DTSTART:${formatDate(start)}
DTEND:${formatDate(end)}
SUMMARY:${title}
DESCRIPTION:${description}\\n\\nLink: ${url}
URL:${url}
END:VEVENT
END:VCALENDAR`;

  return icsContent;
}

function downloadICS(icsContent, filename) {
  const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = filename;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
}
```

**Step 2: Add UI**
```html
<!-- Calendar Button -->
<button id="calendar-btn" class="inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold shadow-lg">
  üìÖ Put in Your Calendar
</button>

<!-- Calendar Modal -->
<div id="calendar-modal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; align-items: center; justify-content: center;">
  <div style="background: white; padding: 32px; border-radius: 12px; max-width: 500px; width: 90%;">
    <h3 style="font-size: 24px; font-weight: bold; margin-bottom: 16px;">
      Schedule Your Ritual
    </h3>

    <label style="display: block; margin-bottom: 8px; font-weight: 600;">
      Choose when you want to do this ritual:
    </label>
    <input
      type="datetime-local"
      id="ritual-datetime"
      style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; margin-bottom: 16px;"
    />

    <div style="display: flex; gap: 12px; justify-content: flex-end;">
      <button id="calendar-cancel" style="padding: 12px 24px; border: 1px solid #d1d5db; border-radius: 6px; background: white;">
        Cancel
      </button>
      <button id="calendar-download" style="padding: 12px 24px; background: #2563eb; color: white; border-radius: 6px; font-weight: 600;">
        Download Calendar Invite
      </button>
    </div>
  </div>
</div>

<script>
// Show modal
document.getElementById('calendar-btn').addEventListener('click', () => {
  document.getElementById('calendar-modal').style.display = 'flex';

  // Set default to tomorrow at 10am
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  tomorrow.setHours(10, 0, 0, 0);

  const dateInput = document.getElementById('ritual-datetime');
  dateInput.value = tomorrow.toISOString().slice(0, 16);
});

// Cancel
document.getElementById('calendar-cancel').addEventListener('click', () => {
  document.getElementById('calendar-modal').style.display = 'none';
});

// Download
document.getElementById('calendar-download').addEventListener('click', () => {
  const datetime = document.getElementById('ritual-datetime').value;

  if (!datetime) {
    alert('Please select a date and time');
    return;
  }

  const startDate = new Date(datetime);
  const title = `Family Art Ritual ‚Äì ${currentContent.title || 'Playlist'}`;
  const description = currentContent.description || 'Watch the calm playlist, explore the content, and enjoy this ritual together.';
  const url = window.location.href;
  const durationMinutes = 30; // Default 30 min

  const icsContent = generateICS(title, description, startDate, durationMinutes, url);
  const filename = `family-ritual-${currentContent.title?.toLowerCase().replace(/\s+/g, '-') || 'playlist'}.ics`;

  downloadICS(icsContent, filename);

  document.getElementById('calendar-modal').style.display = 'none';

  alert('Calendar invite downloaded! Add it to your calendar app.');
});
</script>
```

**Success Criteria:**
- [ ] Button appears and opens modal
- [ ] Date/time picker defaults to tomorrow 10am
- [ ] Download generates valid .ics file
- [ ] File imports correctly to Google Calendar / Apple Calendar
- [ ] Event includes title, description, link back to playlist

---

### Priority 2 (Nice-to-have)

#### Task 2.4: Import from YouTube (Local Render) ‚è≥
**Priority:** MEDIUM
**Time Estimate:** 1 hour (with Option A - reuse creator API)
**Files:** `recursive-landing/index.html`, `recursive-landing/view.html`, `recursive-creator/app/api/extract-playlist/route.ts`

**Feature:** Let users paste YouTube playlist URL, import locally, and view without saving to database.

**Architecture:** Option A - Reuse recursive-creator API

**Implementation Steps:**

**Step 1: Enable CORS on Creator API (5 min)**

File: `recursive-creator/app/api/extract-playlist/route.ts`

```typescript
export async function POST(request: NextRequest) {
  try {
    const { playlistUrl } = await request.json();

    // ... existing logic ...

    return NextResponse.json({
      videos,
      count: videos.length,
      playlistTitle: data.items[0]?.snippet?.channelTitle || 'YouTube Playlist'
    }, {
      headers: {
        'Access-Control-Allow-Origin': 'https://recursive.eco',
        'Access-Control-Allow-Methods': 'POST',
        'Access-Control-Allow-Headers': 'Content-Type'
      }
    });
  } catch (error) {
    // ... error handling ...
  }
}

// Add OPTIONS handler for CORS preflight
export async function OPTIONS() {
  return new NextResponse(null, {
    headers: {
      'Access-Control-Allow-Origin': 'https://recursive.eco',
      'Access-Control-Allow-Methods': 'POST',
      'Access-Control-Allow-Headers': 'Content-Type'
    }
  });
}
```

**Step 2: Add Import UI to Landing Page (30 min)**

File: `recursive-landing/index.html` (or wherever appropriate)

```html
<!-- Import Button -->
<button id="import-playlist-btn" class="btn-primary">
  üé¨ Try Importing a YouTube Playlist
</button>

<!-- Import Modal -->
<div id="import-modal" class="modal" style="display: none;">
  <div class="modal-content">
    <h3>Import YouTube Playlist</h3>
    <p>Paste a YouTube playlist URL to preview it instantly (no account needed)</p>

    <input
      type="text"
      id="playlist-url-input"
      placeholder="https://youtube.com/playlist?list=PLxxx..."
      style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; margin: 16px 0;"
    />

    <div id="import-error" style="display: none; color: #dc2626; background: #fee2e2; padding: 12px; border-radius: 6px; margin: 16px 0;"></div>
    <div id="import-loading" style="display: none; color: #2563eb;">
      Importing playlist... Please wait.
    </div>

    <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 16px;">
      <button id="import-cancel">Cancel</button>
      <button id="import-submit" class="btn-primary">Import & Preview</button>
    </div>
  </div>
</div>

<script>
// Show modal
document.getElementById('import-playlist-btn').addEventListener('click', () => {
  document.getElementById('import-modal').style.display = 'block';
  document.getElementById('import-error').style.display = 'none';
});

// Cancel
document.getElementById('import-cancel').addEventListener('click', () => {
  document.getElementById('import-modal').style.display = 'none';
  document.getElementById('playlist-url-input').value = '';
});

// Import
document.getElementById('import-submit').addEventListener('click', async () => {
  const url = document.getElementById('playlist-url-input').value.trim();
  const errorDiv = document.getElementById('import-error');
  const loadingDiv = document.getElementById('import-loading');

  if (!url) {
    errorDiv.textContent = 'Please enter a playlist URL';
    errorDiv.style.display = 'block';
    return;
  }

  errorDiv.style.display = 'none';
  loadingDiv.style.display = 'block';

  try {
    // Call recursive-creator API (with CORS enabled)
    const response = await fetch('https://creator.recursive.eco/api/extract-playlist', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ playlistUrl: url })
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || 'Failed to fetch playlist');
    }

    const { videos, playlistTitle } = await response.json();

    // Create local playlist data (matches Supabase format)
    const playlistData = {
      id: 'local-' + Date.now(),
      document_data: {
        title: playlistTitle || 'Imported Playlist',
        description: 'Imported from YouTube (temporary - not saved)',
        items: videos.map((v, i) => ({
          position: i + 1,
          type: 'video',
          video_id: v.video_id,
          title: v.title,
          url: v.url
        }))
      }
    };

    // Store in localStorage
    localStorage.setItem('local_playlist', JSON.stringify(playlistData));

    // Redirect to viewer
    window.location.href = '/view.html?local=true';

  } catch (error) {
    console.error('Import error:', error);
    errorDiv.textContent = error.message || 'Failed to import playlist. Please check the URL and try again.';
    errorDiv.style.display = 'block';
    loadingDiv.style.display = 'none';
  }
});
</script>
```

**Step 3: Update Viewer to Support localStorage (20 min)**

File: `recursive-landing/view.html`

```javascript
// Add to loadContent() at the very start
async function loadContent() {
  const urlParams = new URLSearchParams(window.location.search);
  const contentId = urlParams.get('id');
  const isLocal = urlParams.get('local') === 'true';

  // Check for local playlist first
  if (isLocal) {
    const localData = localStorage.getItem('local_playlist');

    if (!localData) {
      showError('No local playlist found. Please import a playlist first.');
      return;
    }

    try {
      const data = JSON.parse(localData);

      currentContent = {
        title: data.document_data.title || 'Imported Playlist',
        description: data.document_data.description || '',
        items: data.document_data.items || []
      };

      if (currentContent.items.length === 0) {
        throw new Error('Playlist has no items');
      }

      currentItems = currentContent.items;
      console.log('‚úÖ Loaded local playlist:', currentItems.length, 'items');

      // Update page metadata
      document.getElementById('page-title').textContent = currentContent.title + ' (Preview)';

      // Show local playlist notice
      showLocalNotice();

      // Show content
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('content-wrapper').classList.remove('hidden');

      // Display first item
      displayItem(currentIndex);

    } catch (error) {
      console.error('Error loading local playlist:', error);
      showError('Failed to load local playlist');
    }

    return; // Don't try to fetch from Supabase
  }

  // Existing Supabase fetch logic continues below...
  // ...
}

// Add notice for local playlists
function showLocalNotice() {
  const notice = document.createElement('div');
  notice.style.cssText = `
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: #fef3c7;
    border: 2px solid #f59e0b;
    color: #92400e;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 14px;
    z-index: 100;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  `;
  notice.innerHTML = `
    üí° This is a temporary preview (stored in your browser).
    <a href="https://creator.recursive.eco" style="color: #92400e; text-decoration: underline; font-weight: bold;">
      Create a free account
    </a> to save it permanently.
  `;
  document.body.appendChild(notice);
}
```

**Success Criteria:**
- [ ] Import button visible on landing page
- [ ] Modal opens with URL input
- [ ] Paste playlist URL ‚Üí fetches from creator API
- [ ] Stores in localStorage
- [ ] Redirects to viewer with ?local=true
- [ ] Viewer loads from localStorage (not Supabase)
- [ ] Shows "temporary preview" notice with CTA to create account

**Benefits:**
- ‚úÖ No authentication required
- ‚úÖ Instant preview
- ‚úÖ Gateway to account creation
- ‚úÖ Reuses existing API (no duplication)
- ‚úÖ Works offline once imported

---

#### Task 2.5: Email Collector CTA ‚è≥
**Priority:** LOW (can wait until after Thanksgiving)
**Time Estimate:** 1.5-2 hours
**Files:** `recursive-landing/view.html`, Supabase (new table)

**Feature:** Collect email for Vibe Coding 201 + kids' playlists interest.

**Note:** This is documented in detail in the root claude.md. Can implement after priority features are complete.

---

## Implementation Order

### Phase 1: Recursive Creator (Quick Wins)
**Total Time:** ~45-75 min

1. ‚úÖ Task 1.1: Fix import append behavior (30-60 min)
2. ‚úÖ Task 1.2: Update license wording (10-15 min)

---

### Phase 2: Recursive Landing (Priority 1 - Thanksgiving Launch)
**Total Time:** ~3-4 hours

3. ‚úÖ Task 2.2: CSV export button (30-45 min) - EASIEST, do first
4. ‚úÖ Task 2.1: Transparent layer for YouTube (1-2 hrs)
5. ‚úÖ Task 2.3: Calendar .ics generation (1.5-2 hrs)

---

### Phase 3: Recursive Landing (Priority 2 - Enhanced UX)
**Total Time:** ~1 hour

6. ‚úÖ Task 2.4: Local playlist import with Option A (1 hr)
   - Step 1: Enable CORS on creator API
   - Step 2: Add import UI to landing
   - Step 3: Update viewer for localStorage

---

### Phase 4: Email Collector (Post-Thanksgiving)
**Total Time:** 1.5-2 hours (optional, not today)

7. ‚è≥ Task 2.5: Email collector CTA

---

## Testing Checklist

### Recursive Creator
- [ ] Import YouTube playlist with existing items ‚Üí appends to end
- [ ] Import Drive folder with existing items ‚Üí appends to end
- [ ] License checkbox has new wording
- [ ] License checkbox required to publish

### Recursive Landing - Priority 1
- [ ] CSV export downloads with all titles and links
- [ ] YouTube link visible but not clickable
- [ ] Calendar button opens modal
- [ ] Calendar download generates valid .ics file
- [ ] .ics file imports to Google Calendar successfully

### Recursive Landing - Priority 2
- [ ] Import YouTube playlist without login
- [ ] Playlist stores in localStorage
- [ ] Viewer loads from localStorage with ?local=true
- [ ] "Create account to save" CTA appears

---

## Deployment Strategy

**Branch:** Continue on `feature/publishing-workflow-20251119` (both repos)

**Steps:**
1. Implement all features in dev branch
2. Test locally (npm run dev)
3. Push to GitHub
4. Deploy to Vercel preview
5. User tests on preview URL
6. If good ‚Üí merge to main
7. Deploy to production

---

## Success Metrics

**Launch Ready:**
- ‚úÖ CSV export (attribution)
- ‚úÖ YouTube link visible (transparency) but not clickable (safety)
- ‚úÖ Calendar scheduling (family planning)
- ‚úÖ Import append working (creator UX)

**Bonus (Enhanced UX):**
- ‚úÖ Local playlist import (try before account)

**Post-Launch:**
- Email collector (gather feedback)

---

## Notes

- Keep README.md updated with safety reasoning
- Document all features in claude.md
- Test on mobile (most families use tablets/phones)
- Verify Thanksgiving deadline feasibility after Phase 1+2 complete

---

**Ready to start!** Let's begin with Phase 1 (Creator fixes) ‚Üí Phase 2 (Landing priority 1) ‚Üí Phase 3 (Local import).
